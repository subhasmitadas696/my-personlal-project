(self.webpackChunkewarehouse=self.webpackChunkewarehouse||[]).push([[817],{3817:(De,fe,k)=>{"use strict";k.r(fe),k.d(fe,{HttpLoaderFactory:()=>Ie,SetworkflowModule:()=>Oe});var J=k(69862),A=k(56223),z=k(76472),t=k(2639),l=k(61420),c=k(60420);class a{constructor(C,i="/assets/i18n/",n=".json"){this.http=C,this.prefix=i,this.suffix=n}getTranslation(C){return this.http.get(`${this.prefix}${C}${this.suffix}`)}}var s=k(89515),r=k(20553),m=k(96814),v=k(57622),d=k(81303),e=k(65879);let u=(()=>{class g{static#e=this.\u0275fac=function(n){return new(n||g)};static#t=this.\u0275cmp=e.Xpm({type:g,selectors:[["app-setworkflow"]],decls:1,vars:0,template:function(n,o){1&n&&e._UZ(0,"router-outlet")},dependencies:[d.lC]})}return g})();var f=k(13519),p=k.n(f),w=k(183),S=k.n(w),b=k(77874),x=k(39007),K=k(78889),Y=k(66755),T=k(84775),ee=k(88663),ae=k(75204),le=k(96226);function ce(g,C){if(1&g&&(e.TgZ(0,"option",97),e._uU(1),e.qZA()),2&g){const i=C.$implicit;e.Q6J("value",i.intId),e.xp6(1),e.hij(" ",i.vchProcessName," ")}}function ne(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"div",10)(1,"select",98,12),e.NdJ("change",function(o){e.CHM(i);const h=e.oxw();return e.KtG(h.showFlowBasedOnComplaintType(o))}),e.TgZ(3,"option",99),e._uU(4,"--Select--"),e.qZA(),e.TgZ(5,"option",97),e._uU(6,"WareHouse Operator"),e.qZA(),e.TgZ(7,"option",97),e._uU(8,"Inspector"),e.qZA(),e.TgZ(9,"option",97),e._uU(10,"Grader"),e.qZA(),e.TgZ(11,"option",97),e._uU(12,"Colletral Manager"),e.qZA()()()}2&g&&(e.xp6(3),e.Q6J("value",0),e.xp6(2),e.Q6J("value",101),e.xp6(2),e.Q6J("value",102),e.xp6(2),e.Q6J("value",103),e.xp6(2),e.Q6J("value",104))}function te(g,C){if(1&g&&(e.TgZ(0,"option",97),e._uU(1),e.qZA()),2&g){const i=C.$implicit;e.Q6J("value",i.ctrlCCStaticValue),e.xp6(1),e.Oqu(i.ctrlCCStaticName)}}function W(g,C){if(1&g){const i=e.EpF();e.ynx(0),e.TgZ(1,"select",100),e.NdJ("change",function(o){e.CHM(i);const h=e.oxw(2);return e.KtG(h.workFlowConfig(o))}),e.TgZ(2,"option",101),e._uU(3,"--Select--"),e.qZA(),e.YNc(4,te,2,2,"option",14),e.qZA(),e.BQk()}if(2&g){const i=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",i.workflowarrDetails)}}function U(g,C){if(1&g&&(e.TgZ(0,"option",97),e._uU(1),e.qZA()),2&g){const i=C.$implicit,n=e.oxw(3);e.Q6J("value",i[n.dynbindvalclmn]),e.xp6(1),e.Oqu(i[n.dynbindtxtclmname])}}function I(g,C){if(1&g){const i=e.EpF();e.ynx(0),e.TgZ(1,"select",100),e.NdJ("change",function(o){e.CHM(i);const h=e.oxw(2);return e.KtG(h.workFlowConfig(o))}),e.TgZ(2,"option",101),e._uU(3,"--Select--"),e.qZA(),e.YNc(4,U,2,2,"option",14),e.qZA(),e.BQk()}if(2&g){const i=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",i.workflowarrDetails)}}function E(g,C){if(1&g&&(e.ynx(0),e.TgZ(1,"div",6)(2,"label",7),e._uU(3),e.qZA(),e.TgZ(4,"div",8)(5,"div",9),e.YNc(6,W,5,1,"ng-container",16),e.YNc(7,I,5,1,"ng-container",16),e.qZA()()(),e.BQk()),2&g){const i=e.oxw();e.xp6(3),e.hij("* ",i.workFlowFormConfg.ctrlLabel,""),e.xp6(3),e.Q6J("ngIf","static"==i.bindType),e.xp6(1),e.Q6J("ngIf","dynamic"==i.bindType)}}function N(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"div",18),e.NdJ("dragstart",function(o){e.CHM(i);const h=e.oxw();return e.KtG(h.drag(o))}),e.TgZ(1,"span",19),e._UZ(2,"i",20),e.qZA(),e._uU(3),e.qZA()}if(2&g){const i=C.$implicit;e.uIk("data-node",i.intRoleId),e.xp6(3),e.hij(" ",i.vchRoleName," ")}}function Z(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"a",107),e.NdJ("click",function(o){e.CHM(i);const h=e.oxw(2);return e.KtG(h.setApplicantAction(o))}),e._uU(1,"\xa0\xa0 "),e.TgZ(2,"i",39),e._uU(3,"\xa0\xa0"),e.qZA()()}if(2&g){const i=e.oxw().$implicit;e.uIk("data-actionid",i.tinApprovalActionId),e.xp6(2),e.uIk("data-actionid",i.tinApprovalActionId)}}function B(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"a",108),e.NdJ("click",function(){e.CHM(i);const o=e.oxw().$implicit,h=e.oxw();return e.KtG(h.chooseAction(o.tinApprovalActionId,o.tinApprovalActionId))}),e._uU(1,"Edit"),e.qZA()}}function R(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"li",102)(1,"div")(2,"input",103),e.NdJ("click",function(){const h=e.CHM(i).$implicit,_=e.oxw();return e.KtG(_.chooseAction(h.tinApprovalActionId,h.tinApprovalActionId))}),e.qZA(),e.TgZ(3,"label",104),e._uU(4),e.qZA()(),e.YNc(5,Z,4,2,"a",105),e.YNc(6,B,2,0,"a",106),e.qZA()}if(2&g){const i=C.$implicit,n=e.oxw();e.xp6(2),e.MGl("id","chk_",i.tinApprovalActionId,""),e.s9C("value",i.tinApprovalActionId),e.xp6(1),e.MGl("for","chk_",i.tinApprovalActionId,""),e.xp6(1),e.Oqu(i.vchActionName),e.xp6(1),e.Q6J("ngIf",n.messageEngine),e.xp6(1),e.Q6J("ngIf",15==i.tinApprovalActionId&&n.selAppDocuments||13==i.tinApprovalActionId&&""!=n.checkedLtrDocs)}}function M(g,C){if(1&g&&(e.TgZ(0,"option",126),e._uU(1),e.qZA()),2&g){const i=C.$implicit,n=e.oxw().$implicit;e.s9C("value",i.eventId),e.Q6J("selected",i.eventId==n.selEvents),e.xp6(1),e.hij(" ",i.eventText," ")}}function D(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"a",127),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.addModeDocs())}),e._uU(1,"+"),e.qZA()}}function q(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"a",128),e.NdJ("click",function(){e.CHM(i);const o=e.oxw().index,h=e.oxw();return e.KtG(h.removeDocs(o))}),e._uU(1,"-"),e.qZA()}}function ie(g,C){if(1&g){const i=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"select",109)(3,"option",101),e._uU(4,"Select"),e.qZA(),e.YNc(5,M,2,3,"option",110),e.qZA()(),e.TgZ(6,"td"),e._UZ(7,"input",111),e.qZA(),e.TgZ(8,"td")(9,"select",112)(10,"option",101),e._uU(11,"--Select--"),e.qZA(),e.TgZ(12,"option",113),e._uU(13,"Document"),e.qZA(),e.TgZ(14,"option",114),e._uU(15,"PDF"),e.qZA(),e.TgZ(16,"option",115),e._uU(17,"Image"),e.qZA(),e.TgZ(18,"option",116),e._uU(19,"Excel"),e.qZA()()(),e.TgZ(20,"td")(21,"select",117)(22,"option",118),e._uU(23," Yes "),e.qZA(),e.TgZ(24,"option",119),e._uU(25," No "),e.qZA()()(),e.TgZ(26,"td")(27,"input",120),e.NdJ("keypress",function(o){e.CHM(i);const h=e.oxw();return e.KtG(h.vldChkLst.isNumberKey(o))}),e.qZA()(),e.TgZ(28,"td")(29,"select",121)(30,"option",122),e._uU(31," KB "),e.qZA(),e.TgZ(32,"option",123),e._uU(33," MB "),e.qZA()()(),e.TgZ(34,"td"),e.YNc(35,D,2,0,"a",124),e.YNc(36,q,2,0,"a",125),e.qZA()()}if(2&g){const i=C.$implicit,n=C.index,o=e.oxw();e.xp6(5),e.Q6J("ngForOf",o.approvalDocEvents),e.xp6(2),e.s9C("value",i.txtDocName),e.xp6(5),e.Q6J("selected","doc"==i.txtFileType),e.xp6(2),e.Q6J("selected","pdf"==i.txtFileType),e.xp6(2),e.Q6J("selected","image"==i.txtFileType),e.xp6(2),e.Q6J("selected","excel"==i.txtFileType),e.xp6(4),e.Q6J("selected","Y"==i.selIsMandatory),e.xp6(2),e.Q6J("selected","N"==i.selIsMandatory),e.xp6(3),e.s9C("value",i.txtFileSize),e.xp6(3),e.Q6J("selected","KB"==i.selSizeType),e.xp6(2),e.Q6J("selected","MB"==i.selSizeType),e.xp6(3),e.Q6J("ngIf",n==o.approvalDocRow.length-1),e.xp6(1),e.Q6J("ngIf",n>0&&n==o.approvalDocRow.length-1)}}function P(g,C){if(1&g&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",129),e.qZA()()),2&g){const i=C.$implicit,n=C.index;e.xp6(2),e.hij(" ",n+1," "),e.xp6(2),e.hij(" ",i.ctrlLabel," "),e.xp6(2),e.s9C("id",i.ctrlId),e.uIk("data-labelName",i.ctrlLabel)("data-columnName",i.columnName)("data-tableName",i.tableName)("data-ctrlId",i.ctrlId)}}function Q(g,C){if(1&g&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input",130),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"label",131),e.qZA()()),2&g){const i=C.$implicit,n=C.index;e.xp6(2),e.MGl("id","chckBoxMail",n+1,""),e.Q6J("value",i.intMessageConfigId),e.uIk("data-mlsmstype",1),e.xp6(2),e.MGl("for","chckBoxMail",n+1,""),e.Q6J("innerHTML",i.vchMessageContent,e.oJD)}}function G(g,C){if(1&g&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input",130),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"label",131),e.qZA()()),2&g){const i=C.$implicit,n=C.index;e.xp6(2),e.MGl("id","chckBoxMailSms",n+1,""),e.Q6J("value",i.intMessageConfigId),e.uIk("data-mlsmstype",1),e.xp6(2),e.MGl("for","chckBoxMailSms",n+1,""),e.Q6J("innerHTML",i.vchMessageContent,e.oJD)}}function de(g,C){if(1&g&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input",130),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"label",131),e.qZA()()),2&g){const i=C.$implicit,n=C.index;e.xp6(2),e.MGl("id","chckBoxMailWhatsApp",n+1,""),e.Q6J("value",i.intMessageConfigId),e.uIk("data-mlsmstype",1),e.xp6(2),e.MGl("for","chckBoxMailWhatsApp",n+1,""),e.Q6J("innerHTML",i.vchMessageContent,e.oJD)}}function Ze(g,C){if(1&g&&(e.ynx(0),e.TgZ(1,"tr")(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._UZ(7,"input",133),e.qZA()(),e.BQk()),2&g){const i=C.$implicit,n=C.index,o=e.oxw(2);e.xp6(3),e.hij(" ",n+1," "),e.xp6(2),e.hij(" ",i.vchLetterName," "),e.xp6(2),e.Q6J("id",n+1)("value",i.intLetterConfigId)("checked",o.selLtrRadioBtn(i.intLetterConfigId))}}function Fe(g,C){if(1&g&&(e.ynx(0),e.TgZ(1,"table",69)(2,"thead")(3,"tr")(4,"th",79),e._uU(5,"Sl#"),e.qZA(),e.TgZ(6,"th",71),e._uU(7,"Letter Name"),e.qZA(),e.TgZ(8,"th",71),e._uU(9,"Choose"),e.qZA()()(),e.TgZ(10,"tbody",132),e.YNc(11,Ze,8,5,"ng-container",74),e.qZA()(),e.BQk()),2&g){const i=e.oxw();e.xp6(11),e.Q6J("ngForOf",i.arrAllLetterDetails)}}function Be(g,C){1&g&&(e.TgZ(0,"h3"),e._uU(1,"No published letter found"),e.qZA())}function Re(g,C){1&g&&(e.TgZ(0,"div",134),e._UZ(1,"div",135),e.TgZ(2,"p"),e._uU(3,'"Loading...'),e.qZA()())}let Le=(()=>{class g{constructor(i,n,o,h,_,y,F,V,j,se,L){this.fb=i,this.route=n,this.httpClient=o,this.router=h,this.commonService=_,this.vldChkLst=y,this.translate=F,this.encDec=V,this.workFlowServices=j,this.WebCommonService=se,this.LetterconfigService=L,this.loading=!1,this.title="Work Flow",this.jsonurl="assets/js/_configs/addWorkflow.config.json",this.arralldynVal=[],this.txtModuleId=null,this.txtFormId=null,this.nodeSelected=null,this.formNames=null,this.txtFormName=null,this.txtModuleName=null,this.roleArr=[],this.allFormsArr=[],this.selForms=0,this.applicantRole="applicant",this.docUploads=[],this.approvalDocuments="",this.approvalDocRow=[1],this.approvalDocEvents=[],this.appDocumentArr=[],this.selectedNodeRoleIdAndRoleName=[],this.selectNodeArr=[],this.allFormDocs=[],this.allAssignedVerifyDocs=[],this.curAssignedVerifyDocs=[],this.langKey="en",this.disabled=!1,this.ShowFilter=!1,this.limitSelection=!1,this.cities=[],this.selectedItems=[],this.dropdownSettings={},this.arrAllFormDetails={},this.arrAllLabelParms=[],this.showConditionStatus=2,this.workFlowFormConfg="",this.workflowarrDetails=[],this.dynFilterDetails="",this.dynFilterCtrlId="",this.arrAllLetterDetails="",this.checkedLtrDocs="",this.ltrIndx=0,this.checkedMailSms="",this.authCheckedMailSms=[],this.msgclickedEvent="",this.mailConigDetails="",this.smsConfigDetails="",this.whatsappConfigDetails="",this.bindType="",this.dynbindtxtclmname="",this.dynbindvalclmn="",this.switchControll=!1,this.complaintTypeId=null;let ue=this.router.snapshot.paramMap.get("id");if(""!=ue){let H=this.encDec.decText(ue).split(":");this.txtModuleId=H[0],this.txtFormId=H[1],this.getsectionId=H[2]}this.sessiontoken=sessionStorage.getItem("ADMIN_SESSION"),this.dynamicForm=this.fb.group({itemId:[this.txtFormId],compId:[this.complaintTypeId],sectionId:[this.getsectionId],formDetails:this.fb.array([]),status:0,otherStatus:"",updatedBy:[this.userId],createdBy:[this.userId],selForms:this.selForms})}ngOnInit(){this.id=document.querySelector("#drawflow"),this.editor=new(S())(this.id),this.registerEvents(this.editor),this.editor.reroute=!0,this.editor.reroute_fix_curvature=!0,this.editor.force_first_input=!1,this.editor.curvature=0,this.editor.line_path=2,this.editor.start();const n=document.getElementsByClassName("drag-drawflow");for(let o=0;o<n.length;o++)n[o].addEventListener("touchend",this.drop,!1),n[o].addEventListener("touchmove",this.positionMobile,!1),n[o].addEventListener("touchstart",this.drag,!1);this.getForms(),this.loadEvents(),this.getRoles(),this.getAllFormName(),this.messageEngine=r.N.messageEngine,1==this.messageEngine&&this.loadMessageEngine(),this.cities=[{item_id:1,item_text:"New Delhi"},{item_id:2,item_text:"Mumbai"},{item_id:3,item_text:"Bangalore"},{item_id:4,item_text:"Pune"},{item_id:5,item_text:"Chennai"},{item_id:6,item_text:"Navsari"}],this.selectedItems=[{item_id:4,item_text:"Pune"},{item_id:6,item_text:"Navsari"}],this.dropdownSettings={singleSelection:!1,idField:"item_id",textField:"item_text",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:3,allowSearchFilter:this.ShowFilter}}changeFunction(i){this.txtFormId=i.target.value,this.custom_serviceFormid=this.txtFormId,this.workFlowControlId=0,160==this.txtFormId?this.switchControll=!0:(this.switchControll=!1,this.fillCanvasWorkflow(),this.loadEvents(),$(".eventSection").find("#txtTimeLine").val(""),this.allFormDocs=[])}showFlowBasedOnComplaintType(i){this.complaintTypeId=i.target.value,this.workFlowControlId=i.target.value,this.custom_serviceFormid=this.txtFormId,console.log(this.complaintTypeId),this.fillCanvasWorkflow(),this.loadEvents(),$(".eventSection").find("#txtTimeLine").val(""),this.allFormDocs=[]}getWorkFlowDetailsFormConfig(){this.workFlowServices.getWorkFlowDetailsFormConfig({processId:this.txtFormId}).subscribe(n=>{let o=n.RESPONSE_DATA;if(n.RESPONSE_TOKEN==b.HmacSHA256(o,r.N.apiHashingKey).toString()){let y=x.lW.from(o,"base64");if(y=JSON.parse(y.toString()),200==y.status)if(y.flowDetails.length>0){let F=JSON.parse(y.flowDetails);this.workFlowFormConfg=F.formDetails,this.bindType=this.workFlowFormConfg.cascadingCtrlDetails[0].ctrlCCbindDatatype,console.log(this.bindType);let V=this.workFlowFormConfg.cascadingCtrlDetails[0].ctrlCCbindDatatype;if("dynamic"==V){console.log(this.workFlowFormConfg);let j=this.workFlowFormConfg.cascadingCtrlDetails[0].ctrlCCDTableName;this.dynbindtxtclmname=this.workFlowFormConfg.cascadingCtrlDetails[0].ctrlCCDTextColumnName,this.dynbindvalclmn=this.workFlowFormConfg.cascadingCtrlDetails[0].ctrlCCDValueColumnName;let se=this.workFlowFormConfg.cascadingCtrlDetails[0].ctrlCCDConditions;console.log(se);let L={tableName:this.encDec.escapeHtml(j),columnName:this.encDec.escapeHtml(this.dynbindtxtclmname+","+this.dynbindvalclmn),condition:this.encDec.escapeHtml(se)};this.dynmaicValApi(L)}else"static"==V&&(this.workflowarrDetails=this.workFlowFormConfg.cascadingCtrlDetails[0].ctrlStaticOptions)}else this.fillCanvasWorkflow();else 417==y.status&&p().fire({icon:"error",text:"Invalid Request !!"})}else p().fire({icon:"error",text:"Invalid Request !!"})})}dynmaicValApi(i){this.WebCommonService.loadDynamicBindDetails(i).subscribe(n=>{let o=n.RESPONSE_DATA;if(n.RESPONSE_TOKEN==b.HmacSHA256(o,r.N.apiHashingKey).toString()){let y=x.lW.from(o,"base64");y=JSON.parse(y.toString()),200==y.status?(console.log(y),""!=y.result&&(this.workflowarrDetails=y.result)):417==y.status&&p().fire({icon:"error",text:"Invalid Request !!"})}else p().fire({icon:"error",text:"Invalid Request !!"})})}loadDynamicCtrls(i){this.WebCommonService.schemeDynCtrl(i).subscribe(n=>{let o=n.RESPONSE_DATA;if(n.RESPONSE_TOKEN==b.HmacSHA256(o,r.N.apiHashingKey).toString()){let y=x.lW.from(o,"base64");if(y=JSON.parse(y.toString()),200==y.status){let F=Object.keys(y.result);for(let V of F)for(let j of y.result[V].formDetails)r.N.workflowconfiguredtypeid.includes(j.ctrlTypeId)&&(this.arrAllFormDetails[j.ctrlId]=[j],this.arrAllLabelParms.push({ctrlId:j.ctrlId,ctrlLabel:j.ctrlLabel}))}else 417==y.status?p().fire({icon:"error",text:"Invalid Request !!"}):p().fire({icon:"error",text:"Error While Getting Data In Dynamic Form !!"})}else p().fire({icon:"error",text:"Invalid Request"})})}loadgetDynamicCtrls(i){}showDependCtrls(i){"1"==i?(document.getElementById("showYesDiv")?.setAttribute("style","display: block;"),document.getElementById("showYesDiv")?.classList.remove("d-none")):(document.getElementById("showYesDiv")?.setAttribute("style","display: none;"),document.getElementById("showYesDiv")?.classList.add("d-none"))}onItemSelect(i){}onSelectAll(i){}toogleShowFilter(){this.ShowFilter=!this.ShowFilter,this.dropdownSettings=Object.assign({},this.dropdownSettings,{allowSearchFilter:this.ShowFilter})}handleLimitSelection(){this.dropdownSettings=Object.assign({},this.dropdownSettings,this.limitSelection?{limitSelection:2}:{limitSelection:null})}loadconfig(){this.httpClient.get(this.jsonurl).subscribe(i=>{this.tablist=i[0].tabList,this.utillist=i[0].utils,this.messaageslist=i[0].messages,this.title=this.multilingual(i[0].pagetitle),this.allConditions=i[0].condtions})}multilingual(i){return i}positionMobile(i){this.mobile_last_move=i}allowDrop(i){i.preventDefault()}drag(i){"touchstart"===i.type?this.mobile_item_selec=i.target.closest(".drag-drawflow").getAttribute("data-node"):i.dataTransfer.setData("node",i.target.getAttribute("data-node"))}drop(i){if(console.log("drop",i),"touchend"!==i.type){let n=i.dataTransfer.getData("node");this.addNodeToDrawFlow(n,i.clientX,i.clientY)}}addNodeToDrawFlow(i,n,o){if("fixed"===this.editor.editor_mode)return!1;n=n*(this.editor.precanvas.clientWidth/(this.editor.precanvas.clientWidth*this.editor.zoom))-this.editor.precanvas.getBoundingClientRect().x*(this.editor.precanvas.clientWidth/(this.editor.precanvas.clientWidth*this.editor.zoom)),o=o*(this.editor.precanvas.clientHeight/(this.editor.precanvas.clientHeight*this.editor.zoom))-this.editor.precanvas.getBoundingClientRect().y*(this.editor.precanvas.clientHeight/(this.editor.precanvas.clientHeight*this.editor.zoom));for(let h of this.roleArr)h.intRoleId==i&&this.editor.addNode(h.vchRoleName,1,1,n,o,"AUTH",{userType:2,desgId:h.vchRoleName,roleId:h.intRoleId},'\n                <div>\n                <div class="box">\n                    '+h.vchRoleName+"\n                </div>\n                </div>\n                ");return"applicant"===i&&this.editor.addNode("applicant",0,1,n,o,"applicant",{userType:1},'\n                      <div>\n                      <div class="box">\n                          Applicant\n                      </div>\n                      </div>\n                      '),!0}getRoleId(i){return i.roleId}registerEvents(i){i.on("nodeCreated",n=>{}),i.on("nodeRemoved",n=>{console.log("Node removed "+n)}),i.on("nodeSelected",n=>{$("#btnConfirmOk").off("click"),this.updateEvents(i,n)}),i.on("nodeUnselected",n=>{this.nodeSelected=null,$("#btnSaveEvent").hide(),$(".eventSection").find(".chk_actions").prop("checked",!1),$(".eventSection").find("#txtTimeLine").val("")}),i.on("moduleCreated",n=>{console.log("Module Created "+n)}),i.on("moduleChanged",n=>{console.log("Module Changed "+n)}),i.on("connectionCreated",n=>{let o=n.input_id,h=this.getLavelCtr(i,o,0),y=i.getNodeFromId(o).data;y.lavel=Number(h),i.updateNodeDataFromId(o,y)}),i.on("connectionRemoved",n=>{console.log("Connection removed"),console.log(n)}),i.on("mouseMove",n=>{}),i.on("nodeMoved",n=>{console.log(i),console.log("Node moved "+n)}),i.on("zoom",n=>{console.log("Zoom level "+n)}),i.on("translate",n=>{console.log("Translate x:"+n.x+" y:"+n.y)}),i.on("addReroute",n=>{console.log("Reroute added "+n)}),i.on("removeReroute",n=>{console.log("Reroute removed "+n)})}drawflow(){return{drawflow:{}}}loadEvents(){this.workFlowServices.getEvents([]).subscribe(n=>{let _=x.lW.from(n.RESPONSE_DATA,"base64");_=JSON.parse(_.toString()),200==_.status&&(this.approvalActions=_.result)})}getRoles(){this.workFlowServices.getAdminRoles([]).subscribe(n=>{let _=x.lW.from(n.RESPONSE_DATA,"base64");_=JSON.parse(_.toString()),200==_.status&&(this.roleArr=_.result)})}getAllFormName(){this.commonService.getFormName([]).subscribe(n=>{let _=x.lW.from(n.RESPONSE_DATA,"base64");_=JSON.parse(_.toString()),200==_.status&&(this.allFormsArr=_.result,console.log(this.allFormsArr))})}validator(){let i=this.dynamicForm.value.selForms;if(console.log("---------------------\x3e"+i),!this.vldChkLst.BlankCheckRdoDropChk("selForms",i,"Form Name"))return!1;if(""!=this.workFlowFormConfg&&""==this.dynFilterDetails)return p().fire({icon:"error",text:"Select "+this.workFlowFormConfg.ctrlLabel}),!1;let n=this.editor.drawflow.drawflow.Home.data,o=Object.keys(n),h=[],y=[],F=!0,j=this,se="";if($(o).each(function(X){let H=o[X],ge=Object.keys(n[H].inputs),re=Object.keys(n[H].outputs),me=[],oe=[];if(re.length>0?oe=n[H].outputs.output_1.connections:n[H].outputs={},ge.length<=0)n[H].inputs={};else if(n[H].inputs.input_1.connections.length>0)for(let he=0;he<n[H].inputs.input_1.connections.length;he++)me.push(n[H].inputs.input_1.connections[he].node);let O=n[H].data;if(oe.length>1&&$(oe).each(function(he){h.push(oe[he].node)}),1==O.userType&&(se=O.allMailSms),2==O.userType){let he=O.lavel>0?O.lavel:0,ve=O.desgId>0?O.desgId:0,Ce=O.roleId>0?O.roleId:0,ke=O.events,_e=O.timeline,Ne=O.approvalDocs,be=O.approvalLetters,Se=O.demandPaymentStaus,xe=O.approvalDocuments,we=O.calcStatus,ye=O.calcDetails,pe="",Ae=O.allMailSms,Te=O.documentVerify;if(!ke)return p().fire({icon:"error",text:"Choose Action Events For Selected Authority !!"}),F=!1,!1;if(pe=ke.join(),""==_e||_e<=0)return p().fire({icon:"error",text:"Enter Timeline In Days !!"}),F=!1,!1;if(1==O.userType)return y.push({output:oe,data:O,currentId:H,stageNo:1}),!1;let Ee=0;Ee=h.includes(H)?1:2;let Ue={tinStageNo:he,desgId:ve,roleId:Ce,authActions:pe,parallel:Ee,selProject:0,selProcess:j.txtFormId,timeline:_e,authDocs:Ne,authLetters:be,demandNoteStatus:Se,approvalDocuments:xe,calcStatus:we,calcDetails:ye,vchParentNodes:me.join(),tinCurrentNode:H,authMailSmsDetails:""!=Ae&&null!=Ae?JSON.stringify(Ae):"",documentVerify:Te};y.push(Ue)}return X}),!F)return!1;if(0==y.length)return p().fire({icon:"error",text:"Please Configure The Workflow !!"}),!1;let L=j.editor.drawflow;L=JSON.stringify(L);let ue={projectId:0,serviceId:this.custom_serviceFormid,workFlowControlId:this.workFlowControlId,paymentType:1,stageData:y,drawData:this.encDec.escapeHtml(L),controlName:"",sectionName:"",projectCategory:0,dynFilterDetails:this.dynFilterDetails,dynFilterCtrlId:this.dynFilterDetails.length>0?this.workFlowFormConfg.ctrlId:"",applicantMailSmsDetails:""!=se&&null!=se?JSON.stringify(se):""};return this.workFlowServices.saveCanvasData(ue).subscribe(X=>{let re=x.lW.from(X.RESPONSE_DATA,"base64");re=JSON.parse(re.toString()),0==re?p().fire({icon:"success",text:"Workflow Configured Successfully !!"}).then(me=>{}):p().fire({icon:"error",text:"Error In Database !!"})}),!0}getForms(){this.commonService.getFormName({moduleId:this.txtModuleId,processId:this.txtFormId}).subscribe(n=>{let _=x.lW.from(n.RESPONSE_DATA,"base64");_=JSON.parse(_.toString()),200==_.status?(this.formNames=_.result,this.formNames.length>0&&(this.txtFormName=this.formNames[0].vchProcessName)):417==_.status?p().fire({icon:"error",text:"Invalid Request !!"}):console.log(_.messages)})}updateEvents(i,n){this.checkedMailSms="",this.checkedLtrDocs="",this.selAppDocuments=null,this.selDraftLetter=null,this.appDocumentArr=[],$("#btnSaveEvent").off("click"),$("#btnAlertOk").off("click"),$("#btnSaveEvent").show(),$(".eventSection").find(".chk_actions").prop("checked",!1),$(".eventSection").find("#txtTimeLine").val(""),$(".eventSection").find("#hdnApprovalDocs").val(""),$(".eventSection").find("#hdnApprovalLetters").val(""),$(".eventSection").find("#hdnAllApprovalDocuments").val(""),$(".eventSection").find("#lnkAuthType").hide(),$(".eventSection").find("#lnkLetterType").hide(),$(".eventSection").find("#approveDocType").hide(),$(".dm21").hide();let o=i.getNodeFromId(n);if(this.selectedNodeRoleIdAndRoleName={roleId:o.data.roleId,roleName:o.data.desgId,nodeId:o.id},o){var h=o.data;let ue=o.data.userType;if(1==ue)document.getElementById("eventsUl")?.classList.add("d-none"),document.getElementById("ConditionDiv")?.classList.add("d-none"),document.getElementById("timelineDiv")?.classList.add("d-none"),document.getElementById("eventsU2")?.classList.remove("d-none"),this.checkedMailSms=null==o.data.allMailSms?"":o.data.allMailSms;else if(2==ue){document.getElementById("eventsU2")?.classList.add("d-none"),document.getElementById("eventsUl")?.classList.remove("d-none"),document.getElementById("ConditionDiv")?.classList.remove("d-none"),document.getElementById("timelineDiv")?.classList.remove("d-none"),this.checkedMailSms=null==o.data.allMailSms?"":o.data.allMailSms,$("#btnSaveEvent").show(),this.nodeSelected=n;var _=o.data.events,y=o.data.timeline,F=o.data.approvalDocs;this.checkedLtrDocs=null!=o.data.approvalLetters?o.data.approvalLetters:"";var V=o.data.demandPaymentStaus,j=o.data.approvalDocuments;this.appDocumentArr=o.data.documentVerify,j&&(this.selAppDocuments=j,this.approvalDocRow=j),null!=this.checkedLtrDocs&&this.checkedLtrDocs.length>0&&(this.selDraftLetter=o.data.approvalLetters);let X=o.data.calcDetails;1==Number(o.data.calcStatus)?($("#calcStatus1").prop("checked",!0),$("#selFieldName").val(X[0].calcfield),$("#selCalc").val(X[0].selCalc),$("#txtValue").val(X[0].txtValue),document.getElementById("showYesDiv")?.setAttribute("style","display: block;"),document.getElementById("showYesDiv")?.classList.remove("d-none")):($("#calcStatus2").prop("checked",!0),$("#selFieldName").val("0"),$("#selCalc").val("0"),$("#txtValue").val(" "),document.getElementById("showYesDiv")?.setAttribute("style","display: none;"),document.getElementById("showYesDiv")?.classList.add("d-none")),$(_).each(function(ge){$('.chk_actions[value="'+_[ge]+'"]').prop("checked",!0)}),$("#txtTimeLine").val(y),""!=F&&typeof F<"u"&&$("#lnkAuthType").show(),""!=this.checkedLtrDocs&&typeof this.checkedLtrDocs<"u"&&$("#lnkLetterType").show(),""!=j&&typeof j<"u"&&$("#approveDocType").show(),""!=V&&typeof V<"u"?(2==Number(V)&&$("#dn").prop("checked",!0),$(".dem21").show()):$(".dem21").hide(),$("#hdnApprovalDocs").val(F),$("#hdnApprovalLetters").val(this.checkedLtrDocs),$("#hdnAllApprovalDocuments").val(j)}else $("#btnSaveEvent").hide()}let L=this;$("#btnSaveEvent").on("click",function(){let ue=i.getNodeFromId(n).data.userType;L.selDraftLetter=null;let X=[],H=0,ge=0,re=0;$(".chk_actions").each(function(){if($(this).is(":checked")){let pe=$(this).val();12==Number(pe)&&(H=1),13==Number(pe)&&(ge=1),32==Number(pe)&&(re=1),X.push(pe)}});let me=0;$("#chk_21").is(":checked")&&(me=1,$("#dn").is(":checked")&&(me=2));let oe=$("#txtTimeLine").val(),O=$("#hdnAllDocs").val(),he=1==H?$("#hdnApprovalDocs").val():"",ve=$("#hdnAllLetters").val(),Ce=1==ge?$("#hdnApprovalLetters").val():"";1==re&&$("#hdnAllApprovalDocuments").val(),""!=he&&(O=O+","+he),""!=Ce&&(ve=ve+","+Ce);let _e=$("#selFieldName").find(":selected").val(),Ne=$("#selFieldName").find(":selected").attr("data-val"),be=$("#selCalc").find(":selected").val(),Se=$("#txtValue").val(),xe=$('input[name="calStatus"]:checked').val(),we=[],ye=!0;if(1==Number(xe)&&(L.vldChkLst.selectDropdown(_e," Select Field Name !!")||(ye=!1),L.vldChkLst.selectDropdown(be," Select Condition !!")||(ye=!1),L.vldChkLst.blankCheck("txtValue",Se,'Value <span class="">Can Not Be Left Blank</span>')||(ye=!1),we.push({calcfield:_e,selCalc:be,txtValue:Se.trim(),dynTableName:Ne.trim(),dyncolName:L.arrAllFormDetails[_e][0].tablecolDetails[0].ctrlTblColName})),h.events=X,h.timeline=oe,h.approvalLetters=L.checkedLtrDocs,h.demandPaymentStaus=me,h.approvalDocuments=L.approvalDocuments,h.verifyDocs=L.allAssignedVerifyDocs,h.calcStatus=xe,h.calcDetails=we,h.allMailSms=L.checkedMailSms,h.documentVerify=L.appDocumentArr,ye){if($("#hdnAllDocs").val(O),$("#hdnAllLetters").val(ve),$("#hdnAllApprovalDocuments").val(L.approvalDocuments),$("#hdnCalcDetails").val(we),$("#hdnAllSmsMail").val(L.checkedMailSms),$("#hdndocumentVerify").val(L.appDocumentArr),2==ue){if(X.length<=0)return p().fire({icon:"error",text:"Choose Action Events For Selected Authority !!"}),!1;if(""==oe||oe<=0)return""==oe?p().fire({icon:"error",text:"Enter Timeline In Days !!"}):oe<=0&&p().fire({icon:"error",text:" Negative Values Are Not Allowed In Days !!"}),!1}return h.events=X,h.timeline=oe,h.approvalLetters=Ce,h.demandPaymentStaus=me,h.approvalDocuments=L.approvalDocuments,h.verifyDocs=L.allAssignedVerifyDocs,h.calcStatus=xe,h.calcDetails=we,i.updateNodeDataFromId(n,h),p().fire({icon:"warning",text:"Event configured successfully. Click submit button for final submission."}).then(pe=>{if(pe.isConfirmed){$(".eventSection").find(".chk_actions").prop("checked",!1),$(".eventSection").find("#txtTimeLine").val(""),$("#lnkAuthType").hide(),$("#lnkLetterType").hide(),$("#approveDocType").hide(),$("#hdnApprovalDocs").val(""),$("#hdnApprovalLetters").val(""),$("#hdnAllApprovalDocuments").val(""),$("#hdnAllSmsMail").val(""),$("#hdndocumentVerify").val(""),$(".dem21").hide(),document.getElementById("showYesDiv")?.setAttribute("style","display: none;"),document.getElementById("showYesDiv")?.classList.add("d-none"),$(".calcStatus").prop("checked",!1),$("#calcStatus2").prop("checked",!0),L.checkedMailSms="",L.approvalDocuments="",L.approvalDocRow=[1],L.checkedLtrDocs="";let Ae=document.getElementsByClassName("mailSmsChkBx");for(let Te of Ae)Te.checked=!1}}),!0}return!1})}getLavelCtr(i,n,o){let h=i.getNodeFromId(n);if(Object.keys(h.inputs).length>0){let y=h.inputs.input_1.connections;y.length>0&&(o++,o=this.getLavelCtr(i,y[0].node,o))}return o}fillCanvasWorkflow(){this.editor.clearModuleSelected(),this.workFlowServices.fillWorkflowData({projectId:0,serviceId:this.txtFormId,workFlowControlId:this.workFlowControlId,paymentType:1,labelId:0,ctrlName:"",projectCategory:0,dynFilterDetails:this.dynFilterDetails}).subscribe(n=>{if(0==n.errorFlag&&n.result){let o=n.result;o=JSON.parse(o),this.editor.import(o);let _=o.drawflow.Home.data,y=Object.keys(_),F="";$(y).each(function(V){let L=_[parseInt(y[V])].data.approvalDocs;typeof L<"u"&&""!=L&&(F=F+L+",")}),F=F.slice(0,-1),$("#hdnAllDocs").val(F)}else{let h=JSON.parse(n.VerifyDocument);for(let _ of h)this.allFormDocs.push(_)}})}chooseAction(i,n){if(null==this.nodeSelected)document.getElementById("chk_"+i).checked=!1,p().fire({icon:"error",text:"Select The Authority To Set The Document !!."});else if(this.approvalDocEvents=[],15==n&&document.getElementById("chk_"+i).checked){document.getElementById("docUpload").click();let o=this;$(".chk_actions").each(function(){if($(this).is(":checked")){let h=$(this).val(),_=$(this).attr("id"),y=$("label[for='"+_+"']").text();15!=h&&o.approvalDocEvents.push({eventId:h,eventText:y})}})}else 12==n&&document.getElementById("chk_"+i).checked?document.getElementById("docVerify").click():13==n&&document.getElementById("chk_"+i).checked&&this.loadLetterDetails()}saveVerifyDocs(){let i=this.selectedNodeRoleIdAndRoleName,n=document.getElementsByClassName("chkVerifyDocs");this.appDocumentArr=[];let o=[];for(let h of n)if(h.checked){let _=h.getAttribute("data-ctrlId"),y=h.getAttribute("data-labelName"),F=h.getAttribute("data-columnName"),V=h.getAttribute("data-tableName");this.appDocumentArr.push({ctrlId:_,roleId:i.roleId,designationName:i.roleName,labelName:y,columnName:F,tableName:V}),o.push(_)}this.selectNodeArr["node_"+i.nodeId]=o}saveApprovalDocs(){let i=[];$(".clsApprovalDocs tr").each(function(n){let o=$(this).find(".selEvents").val(),h=$(this).find(".txtDocName").val(),_=$(this).find(".txtFileType").val(),y=$(this).find(".selIsMandatory").val(),F=$(this).find(".txtFileSize").val(),V=$(this).find(".selSizeType").val();i.push({docId:"doc_"+n,selEvents:o,txtDocName:h,txtFileType:_,selIsMandatory:y,txtFileSize:F,selSizeType:V})}),this.approvalDocuments=i}addModeDocs(){this.approvalDocRow.push(1)}removeDocs(i){this.approvalDocRow.splice(i,1)}workFlowConfig(i){let n=document.getElementsByClassName("chk_actions");for(let o of n)o.checked=!1;document.getElementById("txtTimeLine").value="",document.getElementById("calcStatus2").checked=!0,document.getElementById("showYesDiv").classList.add("d-none"),this.dynFilterDetails=i.target.value,console.log(this.dynFilterDetails),this.fillCanvasWorkflow()}getMessage(i,n){console.log("element id is "+i),console.log("id "+n),null==this.nodeSelected?(document.getElementById("msg_"+i).checked=!1,p().fire({icon:"error",text:"Select the authority to get message ."})):(this.approvalDocEvents=[],document.getElementById("message").click())}loadMessageEngine(){this.workFlowServices.viewMessageConfigPublished({intMessageConfigId:"",intMessageConfigType:"",formId:this.txtFormId,formName:"",messageType:"1"}).subscribe(n=>{let h=x.lW.from(n.RESPONSE_DATA,"base64");n=JSON.parse(h.toString()),console.log("res "+n),this.messageDataToBind=n.result;for(let _ of this.messageDataToBind)1==_.intMessageConfigType?0==this.mailConigDetails.length?this.mailConigDetails=[_]:this.mailConigDetails.push(_):2==_.intMessageConfigType?0==this.smsConfigDetails.length?this.smsConfigDetails=[_]:this.smsConfigDetails.push(_):3==_.intMessageConfigType&&(0==this.whatsappConfigDetails.length?this.whatsappConfigDetails=[_]:this.whatsappConfigDetails.push(_))})}addChangeEventForLabel(){let i=sessionStorage.getItem("USER_LANGPREF"),n=JSON.parse(b.AES.decrypt(i,r.N.apiHashingKey).toString(b.enc.Utf8));setTimeout(()=>{this.langKey=n;let o=document.getElementById("languageListH");o.addEventListener("change",()=>{this.langKey=o.value})},1e3)}loadLetterDetails(){this.loading=!0,this.LetterconfigService.viewAllPublishedLetters({formId:this.txtFormId,LetterName:"",intLetterConfigId:""}).subscribe(n=>{this.loading=!1;let h=x.lW.from(n.RESPONSE_DATA,"base64");h=JSON.parse(h.toString()),200==h.status?(this.arrAllLetterDetails=h.result,document.getElementById("docLetterConfig").click()):p().fire({title:"No Data Found",text:"Please Configure Letter First !!!",icon:"warning"})})}saveAuthLetterConfigs(){this.checkedLtrDocs="";let i=0,n=document.getElementsByClassName("chkLetterConfigs");for(let o of n)o.checked&&(this.checkedLtrDocs+=this.checkedLtrDocs.length>0?","+o.value:o.value,i=1);0==i?p().fire({icon:"error",text:"Select atleast one letter ."}):(document.getElementById("hdnApprovalLetters").value=this.checkedLtrDocs,document.getElementById("docLetterConfig").click())}selLtrRadioBtn(i){return this.checkedLtrDocs.length>0&&!!this.checkedLtrDocs.split(",").includes(i.toString())}setApplicantAction(i){this.msgclickedEvent=i.target.getAttribute("data-actionid");let o=!0;if("Registration"!=this.msgclickedEvent&&(document.getElementById("chk_"+this.msgclickedEvent).checked||(o=!1,p().fire({icon:"error",text:"Select event first."}))),this.checkedMailSms.length>0){console.log(this.checkedMailSms);for(let h of this.checkedMailSms){if(this.msgclickedEvent==h.events){let _=h.allChedkMailMsgs.split(","),y=document.getElementsByClassName("mailSmsChkBx");console.log(_);for(let F of y)F.checked=!!_.includes(F.value);break}{let _=document.getElementsByClassName("mailSmsChkBx");for(let y of _)y.checked=!1}}}else{let h=document.getElementsByClassName("mailSmsChkBx");for(let _ of h)_.checked=!1}o&&document.getElementById("message").click()}saveAllMailSmsActions(){let i=document.getElementsByClassName("mailSmsChkBx"),n="";for(let o of i)o.checked&&(n.length>0?n+=","+o.value:n=o.value);if(this.checkedMailSms.length>0)if("Registration"!=this.msgclickedEvent){let o="";for(let h of this.checkedMailSms)this.msgclickedEvent!=h.events&&(o.length>0?o.push(h):o=h);this.checkedMailSms=[o],this.checkedMailSms.push({allChedkMailMsgs:n,events:this.msgclickedEvent})}else this.checkedMailSms=[{allChedkMailMsgs:n,events:this.msgclickedEvent}];else this.checkedMailSms=[{allChedkMailMsgs:n,events:this.msgclickedEvent}];this.msgclickedEvent=""}showVerifyDocData(){let i=document.getElementsByClassName("chkVerifyDocs");for(let n of i)n.checked=!1;if(null!=this.appDocumentArr)for(let n of this.appDocumentArr)document.getElementById(n.ctrlId).checked=!0}static#e=this.\u0275fac=function(n){return new(n||g)(e.Y36(A.qu),e.Y36(d.F0),e.Y36(J.eN),e.Y36(d.gz),e.Y36(K.R),e.Y36(Y._),e.Y36(s.sK),e.Y36(T.q),e.Y36(ee.z),e.Y36(ae.m),e.Y36(le.D))};static#t=this.\u0275cmp=e.Xpm({type:g,selectors:[["app-addsetworkflow"]],decls:196,vars:22,consts:[[1,"page-title"],["id","page-content",1,"page-controls-section"],[3,"formGroup"],[1,"card"],[1,"card-body"],[1,"controls-section"],[1,"row"],[1,"col-md-4","col-lg-2","mt-2"],[1,"col-md-8","col-lg-3"],[1,"form-group"],[1,"control-item"],["formControlName","selForms","id","selForms",1,"form-select",3,"change"],["selForms",""],["value","0","selected",""],[3,"value",4,"ngFor","ngForOf"],["class","control-item",4,"ngIf"],[4,"ngIf"],[1,"col-sm-2"],["draggable","true",1,"drag-drawflow","border","mt-1",3,"dragstart"],[1,"h5","p-1"],[1,"fa","fa-user"],["class","drag-drawflow border mt-1","draggable","true",3,"dragstart",4,"ngFor","ngForOf"],[1,"col-sm-7"],["id","drawflow",3,"drop","dragover"],[1,"mt-3"],["type","button","value","Submit",1,"btn","btn-success","me-1",3,"click"],["routerLink","/admin/configuration/viewManageform",1,"btn","btn-danger"],[1,"col-sm-3"],[1,"eventSection"],[1,"accordion"],[1,"accordion-item","mb-3"],[1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#event_section","aria-expanded","true","aria-controls","event_section",1,"accordion-button"],["id","event_section",1,"show","collapse","in"],[1,"accordion-body",2,"height","330px","overflow","auto"],["id","eventsUl"],["class","py-2 pl-2 d-flex align-items-center justify-content-between",4,"ngFor","ngForOf"],["id","eventsU2",1,"d-none"],["href","javascript:void(0);",1,"float-end",3,"click"],[1,"icon-email"],["type","hidden","id","hdnApprovalDocs"],["type","hidden","id","hdnAllDocs"],["type","hidden","id","hdnApprovalLetters"],["type","hidden","id","hdnAllLetters"],["type","hidden","id","hdnAllApprovalDocuments","value","test"],["type","hidden","id","hdnCalcDetails"],["type","hidden","id","hdnAllSmsMail"],["type","hidden","id","hdndocumentVerify"],["id","timelineDiv",1,"accordion-item","mb-3"],["type","button","data-bs-toggle","collapse","data-bs-target","#time_section","aria-expanded","true","aria-controls","event_section",1,"accordion-button"],["id","time_section",1,"show","collapse","in"],[1,"accordion-body"],[1,"input-group","input-focus"],["type","text","name","txtTimeLine","id","txtTimeLine","maxlength","2","autocomplete","off",1,"form-control",3,"keypress"],[1,"input-group-text"],[1,"text-center"],["id","btnSaveEvent",1,"btn","btn-success","btn-sm"],["id","docUpload","data-bs-toggle","modal",1,"d-none"],["id","docVerify","data-bs-toggle","modal",1,"d-none",3,"click"],["id","docLetterConfig","data-bs-toggle","modal",1,"d-none"],["id","divUploadDoc","tabindex","-1","aria-labelledby","previewModalLabel","aria-hidden","false",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","staticBackdropLabel",1,"modal-title","mb-0"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"form-group","row"],[1,"col-sm-12"],[1,"table","table-bordered"],["scope","col",2,"width","20%"],["scope","col"],["scope","col",2,"width","8%"],[1,"clsApprovalDocs"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-info",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],["id","divVerifyDoc","tabindex","-1","aria-labelledby","previewModalLabel","aria-hidden","false",1,"modal","fade"],["scope","col",2,"width","90"],[1,"clsVerifyDocs"],["id","message","data-bs-toggle","modal",1,"d-none"],["id","divMessage","tabindex","-1","aria-labelledby","previewModalLabel","aria-hidden","false",1,"modal","fade"],[1,"accordion-item"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseOne","aria-expanded","true","aria-controls","collapseOne",1,"accordion-button"],["id","collapseOne","aria-labelledby","headingOne","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse","show"],["id","headingTwo",1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseTwo","aria-expanded","false","aria-controls","collapseTwo",1,"accordion-button","collapsed"],["id","collapseTwo","aria-labelledby","headingTwo","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse"],["id","headingThree",1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseThree","aria-expanded","false","aria-controls","collapseThree",1,"accordion-button","collapsed"],["id","collapseThree","aria-labelledby","headingThree","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse"],["id","divLetterConfig","tabindex","-1","aria-labelledby","previewModalLabel","aria-hidden","false",1,"modal","fade"],[4,"ngIf","ngIfElse"],["letterNotFound",""],["type","button",1,"btn","btn-info",3,"click"],["class","loader",4,"ngIf"],[3,"value"],["formControlName","selForms","id","selComplaintForms",1,"form-select",3,"change"],["selected","",3,"value"],["name","dynWrkFlwImplementation","id","dynWrkFlwImplementation",1,"form-select",3,"change"],["value","0"],[1,"py-2","pl-2","d-flex","align-items-center","justify-content-between"],["type","checkbox","name","chkActions[]",1,"chk_actions",3,"id","value","click"],[3,"for"],["class","float-end",3,"click",4,"ngIf"],["href","javascript:void(0);",3,"click",4,"ngIf"],[1,"float-end",3,"click"],["href","javascript:void(0);",3,"click"],[1,"form-select","selEvents"],[3,"value","selected",4,"ngFor","ngForOf"],["type","text",1,"form-control","txtDocName",3,"value"],["name","ctrltype",1,"fld-name","form-select","txtFileType"],["value","doc",3,"selected"],["value","pdf",3,"selected"],["value","image",3,"selected"],["value","excel",3,"selected"],[1,"form-select","selIsMandatory"],["value","Y",3,"selected"],["value","N",3,"selected"],["type","text",1,"form-control","txtFileSize",3,"value","keypress"],[1,"form-select","selSizeType"],["value","KB",3,"selected"],["value","MB",3,"selected"],["class","btn btn-sm btn-primary","href","javascript:void(0);",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger","href","javascript:void(0);",3,"click",4,"ngIf"],[3,"value","selected"],["href","javascript:void(0);",1,"btn","btn-sm","btn-primary",3,"click"],["href","javascript:void(0);",1,"btn","btn-sm","btn-danger",3,"click"],["type","checkbox",1,"form-check-input","chkVerifyDocs",3,"id"],["type","checkbox",1,"mailSmsChkBx",3,"id","value"],[1,"form-check-label",3,"for","innerHTML"],[1,"clsLetterConfigs"],["type","checkbox",1,"form-check-input","chkLetterConfigs",3,"id","value","checked"],[1,"loader"],[1,"loader-item"]],template:function(n,o){if(1&n&&(e.TgZ(0,"div",0)(1,"h4"),e._uU(2),e.qZA()(),e.TgZ(3,"div",1)(4,"form",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),e._uU(10,"* Form Name"),e.qZA(),e.TgZ(11,"div",8)(12,"div",9)(13,"div",10)(14,"select",11,12),e.NdJ("change",function(_){return o.changeFunction(_)}),e.TgZ(16,"option",13),e._uU(17,"--Select--"),e.qZA(),e.YNc(18,ce,2,2,"option",14),e.qZA()()()(),e.TgZ(19,"div",8)(20,"div",9),e.YNc(21,ne,13,5,"div",15),e.qZA()()(),e.YNc(22,E,8,3,"ng-container",16),e.TgZ(23,"div",6)(24,"div",17)(25,"div",18),e.NdJ("dragstart",function(_){return o.drag(_)}),e.TgZ(26,"span",19),e._UZ(27,"i",20),e.qZA(),e._uU(28," Applicant "),e.qZA(),e.YNc(29,N,4,2,"div",21),e.qZA(),e.TgZ(30,"div",22)(31,"div",23),e.NdJ("drop",function(_){return o.drop(_)})("dragover",function(_){return o.allowDrop(_)}),e.qZA(),e.TgZ(32,"div",24)(33,"input",25),e.NdJ("click",function(){return o.validator()}),e.qZA(),e.TgZ(34,"a",26),e._uU(35,"Cancel"),e.qZA()()(),e.TgZ(36,"div",27)(37,"div",28)(38,"div",29)(39,"div",30)(40,"h2",31)(41,"a",32),e._uU(42," Events "),e.qZA()(),e.TgZ(43,"div",33)(44,"div",34)(45,"ul",35),e.YNc(46,R,7,6,"li",36),e.qZA(),e.TgZ(47,"ul",37)(48,"li")(49,"label"),e._uU(50," Mail and sms"),e.qZA(),e.TgZ(51,"a",38),e.NdJ("click",function(_){return o.setApplicantAction(_)}),e._UZ(52,"i",39),e.qZA()()(),e._UZ(53,"input",40)(54,"input",41)(55,"input",42)(56,"input",43)(57,"input",44)(58,"input",45)(59,"input",46)(60,"input",47),e.qZA()()(),e.TgZ(61,"div",48)(62,"h2",31)(63,"a",49),e._uU(64," Timeline "),e.qZA()(),e.TgZ(65,"div",50)(66,"div",51)(67,"div",52)(68,"input",53),e.NdJ("keypress",function(_){return o.vldChkLst.isNumberKey(_)}),e.qZA(),e.TgZ(69,"div",54),e._uU(70,"Days"),e.qZA()()()()()(),e.TgZ(71,"div",55)(72,"a",56),e._uU(73,"Save"),e.qZA()()()()()()()()()(),e._UZ(74,"a",57),e.TgZ(75,"a",58),e.NdJ("click",function(){return o.showVerifyDocData()}),e.qZA(),e._UZ(76,"a",59),e.TgZ(77,"div",60)(78,"div",61)(79,"div",62)(80,"div",63)(81,"h5",64),e._uU(82," Configure Documents "),e.qZA(),e._UZ(83,"button",65),e.qZA(),e.TgZ(84,"div",66)(85,"div",67)(86,"div",68)(87,"table",69)(88,"thead")(89,"tr")(90,"th",70),e._uU(91,"Events"),e.qZA(),e.TgZ(92,"th",71),e._uU(93,"Document Name"),e.qZA(),e.TgZ(94,"th",71),e._uU(95,"File Type"),e.qZA(),e.TgZ(96,"th",71),e._uU(97,"Mandatory"),e.qZA(),e.TgZ(98,"th",72),e._uU(99,"File Size"),e.qZA(),e.TgZ(100,"th",72),e._uU(101,"Size Type"),e.qZA(),e._UZ(102,"th",71),e.qZA()(),e.TgZ(103,"tbody",73),e.YNc(104,ie,37,13,"tr",74),e.qZA()()()()(),e.TgZ(105,"div",75)(106,"button",76),e.NdJ("click",function(){return o.saveApprovalDocs()}),e._uU(107," Save "),e.qZA(),e.TgZ(108,"button",77),e._uU(109," Close "),e.qZA()()()()(),e.TgZ(110,"div",78)(111,"div",61)(112,"div",62)(113,"div",63)(114,"h5",64),e._uU(115," Choose Documents "),e.qZA(),e._UZ(116,"button",65),e.qZA(),e.TgZ(117,"div",66)(118,"div",67)(119,"div",68)(120,"table",69)(121,"thead")(122,"tr")(123,"th",79),e._uU(124,"Sl#"),e.qZA(),e.TgZ(125,"th",71),e._uU(126,"Document Name"),e.qZA(),e.TgZ(127,"th",71),e._uU(128,"Choose"),e.qZA()()(),e.TgZ(129,"tbody",80),e.YNc(130,P,7,7,"tr",74),e.qZA()()()()(),e.TgZ(131,"div",75)(132,"button",76),e.NdJ("click",function(){return o.saveVerifyDocs()}),e._uU(133," Save "),e.qZA(),e.TgZ(134,"button",77),e._uU(135," Close "),e.qZA()()()()(),e._UZ(136,"a",81),e.TgZ(137,"div",82)(138,"div",61)(139,"div",62)(140,"div",63)(141,"h5",64),e._uU(142," Send Message "),e.qZA(),e._UZ(143,"button",65),e.qZA(),e.TgZ(144,"div",66)(145,"div",67)(146,"div",68)(147,"div",29)(148,"div",83)(149,"h2",31)(150,"button",84),e._uU(151," Mail "),e.qZA()(),e.TgZ(152,"div",85)(153,"table",69)(154,"tbody"),e.YNc(155,Q,5,5,"tr",74),e.qZA()()()(),e.TgZ(156,"div",83)(157,"h2",86)(158,"button",87),e._uU(159," SMS "),e.qZA()(),e.TgZ(160,"div",88)(161,"table",69)(162,"tbody"),e.YNc(163,G,5,5,"tr",74),e.qZA()()()(),e.TgZ(164,"div",83)(165,"h2",89)(166,"button",90),e._uU(167," Whatsapp "),e.qZA()(),e.TgZ(168,"div",91)(169,"table",69)(170,"tbody"),e.YNc(171,de,5,5,"tr",74),e.qZA()()()()()()()(),e.TgZ(172,"div",75)(173,"button",76),e.NdJ("click",function(){return o.saveAllMailSmsActions()}),e._uU(174," Save "),e.qZA(),e.TgZ(175,"button",77),e._uU(176," Close "),e.qZA()()()()(),e.TgZ(177,"div",92)(178,"div",61)(179,"div",62)(180,"div",63)(181,"h5",64),e._uU(182," Select Letters "),e.qZA(),e._UZ(183,"button",65),e.qZA(),e.TgZ(184,"div",66)(185,"div",67)(186,"div",68),e.YNc(187,Fe,12,1,"ng-container",93),e.YNc(188,Be,2,0,"ng-template",null,94,e.W1O),e.qZA()()(),e.TgZ(190,"div",75)(191,"button",95),e.NdJ("click",function(){return o.saveAuthLetterConfigs()}),e._uU(192," Save "),e.qZA(),e.TgZ(193,"button",77),e._uU(194," Close "),e.qZA()()()()(),e.YNc(195,Re,4,0,"div",96)),2&n){const h=e.MAs(189);e.xp6(2),e.Oqu(o.title),e.xp6(2),e.Q6J("formGroup",o.dynamicForm),e.xp6(14),e.Q6J("ngForOf",o.allFormsArr),e.xp6(3),e.Q6J("ngIf",o.switchControll),e.xp6(1),e.Q6J("ngIf",""!=o.workFlowFormConfg),e.xp6(3),e.uIk("data-node",o.applicantRole),e.xp6(4),e.Q6J("ngForOf",o.roleArr),e.xp6(17),e.Q6J("ngForOf",o.approvalActions),e.xp6(5),e.uIk("data-actionid","Registration"),e.xp6(1),e.uIk("data-actionid","Registration"),e.xp6(22),e.uIk("data-bs-target","#divUploadDoc"),e.xp6(1),e.uIk("data-bs-target","#divVerifyDoc"),e.xp6(1),e.uIk("data-bs-target","#divLetterConfig"),e.xp6(28),e.Q6J("ngForOf",o.approvalDocRow),e.xp6(26),e.Q6J("ngForOf",o.allFormDocs),e.xp6(6),e.uIk("data-bs-target","#divMessage"),e.xp6(19),e.Q6J("ngForOf",o.mailConigDetails),e.xp6(8),e.Q6J("ngForOf",o.smsConfigDetails),e.xp6(8),e.Q6J("ngForOf",o.whatsappConfigDetails),e.xp6(16),e.Q6J("ngIf",o.arrAllLetterDetails.length>0)("ngIfElse",h),e.xp6(8),e.Q6J("ngIf",o.loading)}},dependencies:[A._Y,A.YN,A.Kr,A.EJ,A.JJ,A.JL,A.sg,A.u,m.sg,m.O5,d.rH],styles:[".accordion-button[_ngcontent-%COMP%]{padding:10px}.chk_actions[_ngcontent-%COMP%]{margin-right:5px}.modal-lg[_ngcontent-%COMP%]{--bs-modal-width:80%}"]})}return g})();const Me=[{path:"",component:u},{path:"",component:u,children:[{path:"addsetworkflow",component:Le,canActivate:[v.a]},{path:"addsetworkflow/:id",component:Le,canActivate:[v.a]}]}];let qe=(()=>{class g{static#e=this.\u0275fac=function(n){return new(n||g)};static#t=this.\u0275mod=e.oAB({type:g});static#i=this.\u0275inj=e.cJS({imports:[d.Bz.forChild(Me),d.Bz]})}return g})();const Ie=g=>new a(g,r.N.siteURL+"assets/i18n/",".json");let Oe=(()=>{class g{static#e=this.\u0275fac=function(n){return new(n||g)};static#t=this.\u0275mod=e.oAB({type:g});static#i=this.\u0275inj=e.cJS({imports:[J.JF,A.u5,A.UX,z.JX,l.IJ,c.UM,t.kn.forRoot(),m.ez,s.aw.forRoot({loader:{provide:s.Zw,useFactory:Ie,deps:[J.eN]}}),m.ez,qe]})}return g})()},183:function(De){typeof self<"u"&&self,De.exports=function(fe){var k={};function J(A){if(k[A])return k[A].exports;var z=k[A]={i:A,l:!1,exports:{}};return fe[A].call(z.exports,z,z.exports,J),z.l=!0,z.exports}return J.m=fe,J.c=k,J.d=function(A,z,t){J.o(A,z)||Object.defineProperty(A,z,{enumerable:!0,get:t})},J.r=function(A){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"__esModule",{value:!0})},J.t=function(A,z){if(1&z&&(A=J(A)),8&z||4&z&&"object"==typeof A&&A&&A.__esModule)return A;var t=Object.create(null);if(J.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:A}),2&z&&"string"!=typeof A)for(var l in A)J.d(t,l,function(c){return A[c]}.bind(null,l));return t},J.n=function(A){var z=A&&A.__esModule?function(){return A.default}:function(){return A};return J.d(z,"a",z),z},J.o=function(A,z){return Object.prototype.hasOwnProperty.call(A,z)},J.p="",J(J.s=0)}([function(fe,k,J){"use strict";J.r(k),J.d(k,"default",function(){return A});class A{constructor(t,l=null,c=null){this.events={},this.container=t,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.parent=c,this.noderegister={},this.render=l,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=new Array,this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(t){this.evCache.push(t)}pointermove_handler(t){for(var l=0;l<this.evCache.length;l++)if(t.pointerId==this.evCache[l].pointerId){this.evCache[l]=t;break}if(2==this.evCache.length){var c=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(c>this.prevDiff&&this.zoom_in(),c<this.prevDiff&&this.zoom_out()),this.prevDiff=c}}pointerup_handler(t){this.remove_event(t),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(t){for(var l=0;l<this.evCache.length;l++)if(this.evCache[l].pointerId==t.pointerId){this.evCache.splice(l,1);break}}load(){for(var t in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+t);const l=this.drawflow.drawflow;let c=1;Object.keys(l).map(function(a,s){Object.keys(l[a].data).map(function(r,m){parseInt(r)>=c&&(c=parseInt(r)+1)})}),this.nodeId=c}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((t,l)=>{t.classList.remove("selected")})}click(t){if(this.dispatch("click",t),"fixed"===this.editor_mode){if(t.preventDefault(),"parent-drawflow"!==t.target.classList[0]&&"drawflow"!==t.target.classList[0])return!1;this.ele_selected=t.target.closest(".parent-drawflow")}else"view"===this.editor_mode?(null!=t.target.closest(".drawflow")||t.target.matches(".parent-drawflow"))&&(this.ele_selected=t.target.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=t.target,this.ele_selected=t.target,0===t.button&&this.contextmenuDel(),null!=t.target.closest(".drawflow_content_node")&&(this.ele_selected=t.target.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?"SELECT"!==t.target.tagName&&(this.drag=!0):"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&"SELECT"!==t.target.tagName&&!0!==t.target.hasAttribute("contenteditable")&&(this.drag=!0);break;case"output":this.connection=!0,null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(t.target);break;case"parent-drawflow":case"drawflow":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");const l=this.connection_selected.parentElement.classList;l.length>1&&(this.dispatch("connectionSelected",{output_id:l[2].slice(14),input_id:l[1].slice(13),output_class:l[3],input_class:l[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((c,a)=>{c.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}"touchstart"===t.type?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY,this.mouse_x=t.touches[0].clientX,this.mouse_y=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),["input","output","main-path"].includes(this.ele_selected.classList[0])&&t.preventDefault(),this.dispatch("clickEnd",t)}position(t){if("touchmove"===t.type)var l=t.touches[0].clientX,c=t.touches[0].clientY;else l=t.clientX,c=t.clientY;if(this.connection&&this.updateConnection(l,c),this.editor_selected&&(this.dispatch("translate",{x:a=this.canvas_x+-(this.pos_x-l),y:s=this.canvas_y+-(this.pos_y-c)}),this.precanvas.style.transform="translate("+a+"px, "+s+"px) scale("+this.zoom+")"),this.drag){t.preventDefault();var a=(this.pos_x-l)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),s=(this.pos_y-c)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=l,this.pos_y=c,this.ele_selected.style.top=this.ele_selected.offsetTop-s+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-a+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-a,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-s,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){a=(this.pos_x-l)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),s=(this.pos_y-c)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom),this.pos_x=l,this.pos_y=c;var r=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),m=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",r),this.ele_selected.setAttributeNS(null,"cy",m);const v=this.ele_selected.parentElement.classList[2].slice(9),d=this.ele_selected.parentElement.classList[1].slice(13),e=this.ele_selected.parentElement.classList[3],u=this.ele_selected.parentElement.classList[4];let f=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(f-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,f<0&&(f=0));const p=v.slice(5),w=this.drawflow.drawflow[this.module].data[p].outputs[e].connections.findIndex(function(b,x){return b.node===d&&b.output===u});this.drawflow.drawflow[this.module].data[p].outputs[e].connections[w].points[f]={pos_x:r,pos_y:m};const S=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(S)}"touchmove"===t.type&&(this.mouse_x=l,this.mouse_y=c),this.dispatch("mouseMove",{x:l,y:c})}dragEnd(t){if("touchend"===t.type)var l=this.mouse_x,c=this.mouse_y,a=document.elementFromPoint(l,c);else l=t.clientX,c=t.clientY,a=t.target;if(this.drag&&(this.pos_x_start==l&&this.pos_y_start==c||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==l&&this.pos_y_start==c||this.dispatch("rerouteMoved",this.ele_selected.parentElement.classList[2].slice(14))),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-l),this.canvas_y=this.canvas_y+-(this.pos_y-c),this.editor_selected=!1),!0===this.connection)if("input"===a.classList[0]||this.force_first_input&&(null!=a.closest(".drawflow_content_node")||"drawflow-node"===a.classList[0])){if(!this.force_first_input||null==a.closest(".drawflow_content_node")&&"drawflow-node"!==a.classList[0])s=a.parentElement.parentElement.id,r=a.classList[1];else{if(null!=a.closest(".drawflow_content_node"))var s=a.closest(".drawflow_content_node").parentElement.id;else s=a.id;if(0===Object.keys(this.getNodeFromId(s.slice(5)).inputs).length)var r=!1;else r="input_1"}var m=this.ele_selected.parentElement.parentElement.id,v=this.ele_selected.classList[1];if(m!==s&&!1!==r){if(0===this.container.querySelectorAll(".connection.node_in_"+s+".node_out_"+m+"."+v+"."+r).length){this.connection_ele.classList.add("node_in_"+s),this.connection_ele.classList.add("node_out_"+m),this.connection_ele.classList.add(v),this.connection_ele.classList.add(r);var d=s.slice(5),e=m.slice(5);this.drawflow.drawflow[this.module].data[e].outputs[v].connections.push({node:d,output:r}),this.drawflow.drawflow[this.module].data[d].inputs[r].connections.push({node:e,input:v}),this.updateConnectionNodes("node-"+e),this.updateConnectionNodes("node-"+d),this.dispatch("connectionCreated",{output_id:e,input_id:d,output_class:v,input_class:r})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)}contextmenu(t){if(this.dispatch("contextmenu",t),t.preventDefault(),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var l=document.createElement("div");l.classList.add("drawflow-delete"),l.innerHTML="x",this.node_selected&&this.node_selected.appendChild(l),this.connection_selected&&this.connection_selected.parentElement.classList.length>1&&(l.style.top=t.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",l.style.left=t.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(l))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(t){if(this.dispatch("keydown",t),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;("Delete"===t.key||"Backspace"===t.key&&t.metaKey)&&(null!=this.node_selected&&"INPUT"!==this.first_click.tagName&&"TEXTAREA"!==this.first_click.tagName&&!0!==this.first_click.hasAttribute("contenteditable")&&this.removeNodeId(this.node_selected.id),null!=this.connection_selected&&this.removeConnection())}zoom_enter(t,l){t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){1!=this.zoom&&(this.zoom=1,this.zoom_refresh())}createCurvature(t,l,c,a,s,r){var m=t,v=l,d=c,e=a,u=s;switch(r){case"open":if(t>=c)var f=m+Math.abs(d-m)*u,p=d-Math.abs(d-m)*(-1*u);else f=m+Math.abs(d-m)*u,p=d-Math.abs(d-m)*u;return" M "+m+" "+v+" C "+f+" "+v+" "+p+" "+e+" "+d+"  "+e;case"close":return t>=c?(f=m+Math.abs(d-m)*(-1*u),p=d-Math.abs(d-m)*u):(f=m+Math.abs(d-m)*u,p=d-Math.abs(d-m)*u)," M "+m+" "+v+" C "+f+" "+v+" "+p+" "+e+" "+d+"  "+e;case"other":return t>=c?(f=m+Math.abs(d-m)*(-1*u),p=d-Math.abs(d-m)*(-1*u)):(f=m+Math.abs(d-m)*u,p=d-Math.abs(d-m)*u)," M "+m+" "+v+" C "+f+" "+v+" "+p+" "+e+" "+d+"  "+e;default:return" M "+m+" "+v+" C "+(f=m+Math.abs(d-m)*u)+" "+v+" "+(p=d-Math.abs(d-m)*u)+" "+e+" "+d+"  "+e}}drawConnection(t){var l=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=l;var c=document.createElementNS("http://www.w3.org/2000/svg","path");c.classList.add("main-path"),c.setAttributeNS(null,"d",""),l.classList.add("connection"),l.appendChild(c),this.precanvas.appendChild(l);var a=t.parentElement.parentElement.id.slice(5);this.dispatch("connectionStart",{output_id:a,output_class:t.classList[1]})}updateConnection(t,l){const c=this.precanvas,a=this.zoom;let s=c.clientWidth/(c.clientWidth*a);s=s||0;let r=c.clientHeight/(c.clientHeight*a);r=r||0;var m=this.connection_ele.children[0],v=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-c.getBoundingClientRect().x)*s,d=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-c.getBoundingClientRect().y)*r,e=t*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),u=l*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),p=this.createCurvature(v,d,e,u,this.curvature,"openclose");m.setAttributeNS(null,"d",p)}addConnection(t,l,c,a){var s=this.getModuleFromNodeId(t);if(s===this.getModuleFromNodeId(l)){var r=this.getNodeFromId(t),m=!1;for(var v in r.outputs[c].connections){var d=r.outputs[c].connections[v];d.node==l&&d.output==a&&(m=!0)}if(!1===m){if(this.drawflow.drawflow[s].data[t].outputs[c].connections.push({node:l.toString(),output:a}),this.drawflow.drawflow[s].data[l].inputs[a].connections.push({node:t.toString(),input:c}),this.module===s){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.classList.add("main-path"),u.setAttributeNS(null,"d",""),e.classList.add("connection"),e.classList.add("node_in_node-"+l),e.classList.add("node_out_node-"+t),e.classList.add(c),e.classList.add(a),e.appendChild(u),this.precanvas.appendChild(e),this.updateConnectionNodes("node-"+t),this.updateConnectionNodes("node-"+l)}this.dispatch("connectionCreated",{output_id:t,input_id:l,output_class:c,input_class:a})}}}updateConnectionNodes(t){const l="node_in_"+t,a=this.container,s=this.precanvas,r=this.curvature,m=this.createCurvature,v=this.reroute_curvature,d=this.reroute_curvature_start_end,e=this.reroute_fix_curvature,u=this.reroute_width,f=this.zoom;let p=s.clientWidth/(s.clientWidth*f);p=p||0;let w=s.clientHeight/(s.clientHeight*f);w=w||0;const S=a.querySelectorAll(".node_out_"+t);Object.keys(S).map(function(x,K){if(null===S[x].querySelector(".point")){var Y=a.querySelector("#"+t),T=S[x].classList[1].replace("node_in_",""),ee=a.querySelector("#"+T).querySelectorAll("."+S[x].classList[4])[0],ae=ee.offsetWidth/2+(ee.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,le=ee.offsetHeight/2+(ee.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,ce=Y.querySelectorAll("."+S[x].classList[3])[0],ne=ce.offsetWidth/2+(ce.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,te=ce.offsetHeight/2+(ce.getBoundingClientRect().y-s.getBoundingClientRect().y)*w;const W=m(ne,te,ae,le,r,"openclose");S[x].children[0].setAttributeNS(null,"d",W)}else{const W=S[x].querySelectorAll(".point");let U="";const I=[];W.forEach((E,N)=>{if(0===N&&W.length-1==0){var Z=a.querySelector("#"+t),B=((P=E).getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,R=(P.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,M=(Q=Z.querySelectorAll("."+E.parentElement.classList[3])[0]).offsetWidth/2+(Q.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,D=Q.offsetHeight/2+(Q.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,q=m(M,D,B,R,d,"open");U+=q,I.push(q),Z=E;var ie=E.parentElement.classList[1].replace("node_in_",""),P=(G=a.querySelector("#"+ie)).querySelectorAll("."+E.parentElement.classList[4])[0];B=(de=G.querySelectorAll("."+E.parentElement.classList[4])[0]).offsetWidth/2+(de.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,R=de.offsetHeight/2+(de.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,M=(Z.getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,D=(Z.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,q=m(M,D,B,R,d,"close"),U+=q,I.push(q)}else if(0===N){var Q;Z=a.querySelector("#"+t),B=((P=E).getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,R=(P.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,M=(Q=Z.querySelectorAll("."+E.parentElement.classList[3])[0]).offsetWidth/2+(Q.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,D=Q.offsetHeight/2+(Q.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,q=m(M,D,B,R,d,"open"),U+=q,I.push(q),Z=E,B=((P=W[N+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,R=(P.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,M=(Z.getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,D=(Z.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,q=m(M,D,B,R,v,"other"),U+=q,I.push(q)}else if(N===W.length-1){var G,de;Z=E,ie=E.parentElement.classList[1].replace("node_in_",""),P=(G=a.querySelector("#"+ie)).querySelectorAll("."+E.parentElement.classList[4])[0],B=(de=G.querySelectorAll("."+E.parentElement.classList[4])[0]).offsetWidth/2+(de.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,R=de.offsetHeight/2+(de.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,M=(Z.getBoundingClientRect().x-s.getBoundingClientRect().x)*(s.clientWidth/(s.clientWidth*f))+u,D=(Z.getBoundingClientRect().y-s.getBoundingClientRect().y)*(s.clientHeight/(s.clientHeight*f))+u,q=m(M,D,B,R,d,"close"),U+=q,I.push(q)}else Z=E,B=((P=W[N+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*(s.clientWidth/(s.clientWidth*f))+u,R=(P.getBoundingClientRect().y-s.getBoundingClientRect().y)*(s.clientHeight/(s.clientHeight*f))+u,M=(Z.getBoundingClientRect().x-s.getBoundingClientRect().x)*(s.clientWidth/(s.clientWidth*f))+u,D=(Z.getBoundingClientRect().y-s.getBoundingClientRect().y)*(s.clientHeight/(s.clientHeight*f))+u,q=m(M,D,B,R,v,"other"),U+=q,I.push(q)}),e?I.forEach((E,N)=>{S[x].children[N].setAttributeNS(null,"d",E)}):S[x].children[0].setAttributeNS(null,"d",U)}});const b=a.querySelectorAll("."+l);Object.keys(b).map(function(x,K){if(null===b[x].querySelector(".point")){var Y=a.querySelector("#"+t),T=b[x].classList[2].replace("node_out_",""),ee=a.querySelector("#"+T).querySelectorAll("."+b[x].classList[3])[0],ae=ee.offsetWidth/2+(ee.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,le=ee.offsetHeight/2+(ee.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,ce=(Y=Y.querySelectorAll("."+b[x].classList[4])[0]).offsetWidth/2+(Y.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,ne=Y.offsetHeight/2+(Y.getBoundingClientRect().y-s.getBoundingClientRect().y)*w;const te=m(ae,le,ce,ne,r,"openclose");b[x].children[0].setAttributeNS(null,"d",te)}else{const te=b[x].querySelectorAll(".point");let W="";const U=[];te.forEach((I,E)=>{if(0===E&&te.length-1==0){var N=a.querySelector("#"+t),Z=((ie=I).getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,B=(ie.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,R=(G=N.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(G.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,M=G.offsetHeight/2+(G.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,D=m(Z,B,R,M,d,"close");W+=D,U.push(D),N=I;var q=I.parentElement.classList[2].replace("node_out_",""),ie=(Q=a.querySelector("#"+q)).querySelectorAll("."+I.parentElement.classList[3])[0];Z=(P=Q.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(P.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,B=P.offsetHeight/2+(P.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,R=(N.getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,M=(N.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,D=m(Z,B,R,M,d,"open"),W+=D,U.push(D)}else if(0===E){var P;N=I,q=I.parentElement.classList[2].replace("node_out_",""),ie=(Q=a.querySelector("#"+q)).querySelectorAll("."+I.parentElement.classList[3])[0],Z=(P=Q.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(P.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,B=P.offsetHeight/2+(P.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,R=(N.getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,M=(N.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,D=m(Z,B,R,M,d,"open"),W+=D,U.push(D),N=I,R=((ie=te[E+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,M=(ie.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,Z=(N.getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,B=(N.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,D=m(Z,B,R,M,v,"other"),W+=D,U.push(D)}else if(E===te.length-1){var Q,G;N=I,q=I.parentElement.classList[1].replace("node_in_",""),ie=(Q=a.querySelector("#"+q)).querySelectorAll("."+I.parentElement.classList[4])[0],R=(G=Q.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(G.getBoundingClientRect().x-s.getBoundingClientRect().x)*p,M=G.offsetHeight/2+(G.getBoundingClientRect().y-s.getBoundingClientRect().y)*w,Z=(N.getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,B=(N.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,D=m(Z,B,R,M,d,"close"),W+=D,U.push(D)}else N=I,R=((ie=te[E+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,M=(ie.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,Z=(N.getBoundingClientRect().x-s.getBoundingClientRect().x)*p+u,B=(N.getBoundingClientRect().y-s.getBoundingClientRect().y)*w+u,D=m(Z,B,R,M,v,"other"),W+=D,U.push(D)}),e?U.forEach((I,E)=>{b[x].children[E].setAttributeNS(null,"d",I)}):b[x].children[0].setAttributeNS(null,"d",W)}})}dblclick(t){null!=this.connection_selected&&this.reroute&&this.createReroutePoint(this.connection_selected),"point"===t.target.classList[0]&&this.removeReroutePoint(t.target)}createReroutePoint(t){this.connection_selected.classList.remove("selected");const l=this.connection_selected.parentElement.classList[2].slice(9),c=this.connection_selected.parentElement.classList[1].slice(13),a=this.connection_selected.parentElement.classList[3],s=this.connection_selected.parentElement.classList[4];this.connection_selected=null;const r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.classList.add("point");var m=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),v=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));r.setAttributeNS(null,"cx",m),r.setAttributeNS(null,"cy",v),r.setAttributeNS(null,"r",this.reroute_width);let d=0;if(this.reroute_fix_curvature){const p=t.parentElement.querySelectorAll(".main-path").length;var e=document.createElementNS("http://www.w3.org/2000/svg","path");if(e.classList.add("main-path"),e.setAttributeNS(null,"d",""),t.parentElement.insertBefore(e,t.parentElement.children[p]),1===p)t.parentElement.appendChild(r);else{const w=Array.from(t.parentElement.children).indexOf(t);d=w,t.parentElement.insertBefore(r,t.parentElement.children[w+p+1])}}else t.parentElement.appendChild(r);const u=l.slice(5),f=this.drawflow.drawflow[this.module].data[u].outputs[a].connections.findIndex(function(p,w){return p.node===c&&p.output===s});void 0===this.drawflow.drawflow[this.module].data[u].outputs[a].connections[f].points&&(this.drawflow.drawflow[this.module].data[u].outputs[a].connections[f].points=[]),this.reroute_fix_curvature?(d>0||this.drawflow.drawflow[this.module].data[u].outputs[a].connections[f].points!==[]?this.drawflow.drawflow[this.module].data[u].outputs[a].connections[f].points.splice(d,0,{pos_x:m,pos_y:v}):this.drawflow.drawflow[this.module].data[u].outputs[a].connections[f].points.push({pos_x:m,pos_y:v}),t.parentElement.querySelectorAll(".main-path").forEach((p,w)=>{p.classList.remove("selected")})):this.drawflow.drawflow[this.module].data[u].outputs[a].connections[f].points.push({pos_x:m,pos_y:v}),this.dispatch("addReroute",u),this.updateConnectionNodes(l)}removeReroutePoint(t){const l=t.parentElement.classList[2].slice(9),c=t.parentElement.classList[1].slice(13),a=t.parentElement.classList[3],s=t.parentElement.classList[4];let r=Array.from(t.parentElement.children).indexOf(t);const m=l.slice(5),v=this.drawflow.drawflow[this.module].data[m].outputs[a].connections.findIndex(function(d,e){return d.node===c&&d.output===s});if(this.reroute_fix_curvature){const d=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[d-1].remove(),r-=d,r<0&&(r=0)}else r--;this.drawflow.drawflow[this.module].data[m].outputs[a].connections[v].points.splice(r,1),t.remove(),this.dispatch("removeReroute",m),this.updateConnectionNodes(l)}registerNode(t,l,c=null,a=null){this.noderegister[t]={html:l,props:c,options:a}}getNodeFromId(t){var l=this.getModuleFromNodeId(t);return JSON.parse(JSON.stringify(this.drawflow.drawflow[l].data[t]))}getNodesFromName(t){var l=[];const c=this.drawflow.drawflow;return Object.keys(c).map(function(a,s){for(var r in c[a].data)c[a].data[r].name==t&&l.push(c[a].data[r].id)}),l}addNode(t,l,c,a,s,r,m,v,d=!1){if(this.useuuid)var e=this.getUuid();else e=this.nodeId;const u=document.createElement("div");u.classList.add("parent-node");const f=document.createElement("div");f.innerHTML="",f.setAttribute("id","node-"+e),f.classList.add("drawflow-node"),""!=r&&f.classList.add(...r.split(" "));const p=document.createElement("div");p.classList.add("inputs");const w=document.createElement("div");w.classList.add("outputs");const S={};for(var b=0;b<l;b++){const T=document.createElement("div");T.classList.add("input"),T.classList.add("input_"+(b+1)),S["input_"+(b+1)]={connections:[]},p.appendChild(T)}const x={};for(b=0;b<c;b++){const T=document.createElement("div");T.classList.add("output"),T.classList.add("output_"+(b+1)),x["output_"+(b+1)]={connections:[]},w.appendChild(T)}const K=document.createElement("div");if(K.classList.add("drawflow_content_node"),!1===d)K.innerHTML=v;else if(!0===d)K.appendChild(this.noderegister[v].html.cloneNode(!0));else if(3===parseInt(this.render.version)){let T=this.render.h(this.noderegister[v].html,this.noderegister[v].props,this.noderegister[v].options);T.appContext=this.parent,this.render.render(T,K)}else{let T=new this.render({parent:this.parent,render:ee=>ee(this.noderegister[v].html,{props:this.noderegister[v].props}),...this.noderegister[v].options}).$mount();K.appendChild(T.$el)}return Object.entries(m).forEach(function(T,ee){if("object"==typeof T[1])!function ce(ne,te,W){null!==(ne=null===ne?m[te]:ne[te])&&Object.entries(ne).forEach(function(U,I){if("object"==typeof U[1])ce(ne,U[0],W+"-"+U[0]);else for(var E=K.querySelectorAll("[df-"+W+"-"+U[0]+"]"),N=0;N<E.length;N++)E[N].value=U[1],E[N].isContentEditable&&(E[N].innerText=U[1])})}(null,T[0],T[0]);else for(var ae=K.querySelectorAll("[df-"+T[0]+"]"),le=0;le<ae.length;le++)ae[le].value=T[1],ae[le].isContentEditable&&(ae[le].innerText=T[1])}),f.appendChild(p),f.appendChild(K),f.appendChild(w),f.style.top=s+"px",f.style.left=a+"px",u.appendChild(f),this.precanvas.appendChild(u),this.drawflow.drawflow[this.module].data[e]={id:e,name:t,data:m,class:r,html:v,typenode:d,inputs:S,outputs:x,pos_x:a,pos_y:s},this.dispatch("nodeCreated",e),this.useuuid||this.nodeId++,e}addNodeImport(t,l){const c=document.createElement("div");c.classList.add("parent-node");const a=document.createElement("div");a.innerHTML="",a.setAttribute("id","node-"+t.id),a.classList.add("drawflow-node"),""!=t.class&&a.classList.add(...t.class.split(" "));const s=document.createElement("div");s.classList.add("inputs");const r=document.createElement("div");r.classList.add("outputs"),Object.keys(t.inputs).map(function(d,e){const u=document.createElement("div");u.classList.add("input"),u.classList.add(d),s.appendChild(u),Object.keys(t.inputs[d].connections).map(function(f,p){var w=document.createElementNS("http://www.w3.org/2000/svg","svg"),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.classList.add("main-path"),S.setAttributeNS(null,"d",""),w.classList.add("connection"),w.classList.add("node_in_node-"+t.id),w.classList.add("node_out_node-"+t.inputs[d].connections[f].node),w.classList.add(t.inputs[d].connections[f].input),w.classList.add(d),w.appendChild(S),l.appendChild(w)})});for(var m=0;m<Object.keys(t.outputs).length;m++){const d=document.createElement("div");d.classList.add("output"),d.classList.add("output_"+(m+1)),r.appendChild(d)}const v=document.createElement("div");if(v.classList.add("drawflow_content_node"),!1===t.typenode)v.innerHTML=t.html;else if(!0===t.typenode)v.appendChild(this.noderegister[t.html].html.cloneNode(!0));else if(3===parseInt(this.render.version)){let d=this.render.h(this.noderegister[t.html].html,this.noderegister[t.html].props,this.noderegister[t.html].options);d.appContext=this.parent,this.render.render(d,v)}else{let d=new this.render({parent:this.parent,render:e=>e(this.noderegister[t.html].html,{props:this.noderegister[t.html].props}),...this.noderegister[t.html].options}).$mount();v.appendChild(d.$el)}Object.entries(t.data).forEach(function(d,e){if("object"==typeof d[1])!function p(w,S,b){null!==(w=null===w?t.data[S]:w[S])&&Object.entries(w).forEach(function(x,K){if("object"==typeof x[1])p(w,x[0],b+"-"+x[0]);else for(var Y=v.querySelectorAll("[df-"+b+"-"+x[0]+"]"),T=0;T<Y.length;T++)Y[T].value=x[1],Y[T].isContentEditable&&(Y[T].innerText=x[1])})}(null,d[0],d[0]);else for(var u=v.querySelectorAll("[df-"+d[0]+"]"),f=0;f<u.length;f++)u[f].value=d[1],u[f].isContentEditable&&(u[f].innerText=d[1])}),a.appendChild(s),a.appendChild(v),a.appendChild(r),a.style.top=t.pos_y+"px",a.style.left=t.pos_x+"px",c.appendChild(a),this.precanvas.appendChild(c)}addRerouteImport(t){const l=this.reroute_width,c=this.reroute_fix_curvature,a=this.container;Object.keys(t.outputs).map(function(s,r){Object.keys(t.outputs[s].connections).map(function(m,v){const d=t.outputs[s].connections[m].points;void 0!==d&&d.forEach((e,u)=>{const w=a.querySelector(".connection.node_in_node-"+t.outputs[s].connections[m].node+".node_out_node-"+t.id+"."+s+"."+t.outputs[s].connections[m].output);if(c&&0===u)for(var S=0;S<d.length;S++){var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.classList.add("main-path"),b.setAttributeNS(null,"d",""),w.appendChild(b)}const x=document.createElementNS("http://www.w3.org/2000/svg","circle");x.classList.add("point");var Y=e.pos_y;x.setAttributeNS(null,"cx",e.pos_x),x.setAttributeNS(null,"cy",Y),x.setAttributeNS(null,"r",l),w.appendChild(x)})})})}updateNodeValue(t){for(var l=t.target.attributes,c=0;c<l.length;c++)if(l[c].nodeName.startsWith("df-")){for(var a=l[c].nodeName.slice(3).split("-"),s=this.drawflow.drawflow[this.module].data[t.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,r=0;r<a.length-1;r+=1)null==s[a[r]]&&(s[a[r]]={}),s=s[a[r]];s[a[a.length-1]]=t.target.value,t.target.isContentEditable&&(s[a[a.length-1]]=t.target.innerText),this.dispatch("nodeDataChanged",t.target.closest(".drawflow_content_node").parentElement.id.slice(5))}}updateNodeDataFromId(t,l){var c=this.getModuleFromNodeId(t);if(this.drawflow.drawflow[c].data[t].data=l,this.module===c){const a=this.container.querySelector("#node-"+t);Object.entries(l).forEach(function(s,r){if("object"==typeof s[1])!function d(e,u,f){null!==(e=null===e?l[u]:e[u])&&Object.entries(e).forEach(function(p,w){if("object"==typeof p[1])d(e,p[0],f+"-"+p[0]);else for(var S=a.querySelectorAll("[df-"+f+"-"+p[0]+"]"),b=0;b<S.length;b++)S[b].value=p[1],S[b].isContentEditable&&(S[b].innerText=p[1])})}(null,s[0],s[0]);else for(var m=a.querySelectorAll("[df-"+s[0]+"]"),v=0;v<m.length;v++)m[v].value=s[1],m[v].isContentEditable&&(m[v].innerText=s[1])})}}addNodeInput(t){var l=this.getModuleFromNodeId(t);const c=this.getNodeFromId(t),a=Object.keys(c.inputs).length;if(this.module===l){const s=document.createElement("div");s.classList.add("input"),s.classList.add("input_"+(a+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(s),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[l].data[t].inputs["input_"+(a+1)]={connections:[]}}addNodeOutput(t){var l=this.getModuleFromNodeId(t);const c=this.getNodeFromId(t),a=Object.keys(c.outputs).length;if(this.module===l){const s=document.createElement("div");s.classList.add("output"),s.classList.add("output_"+(a+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(s),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[l].data[t].outputs["output_"+(a+1)]={connections:[]}}removeNodeInput(t,l){var c=this.getModuleFromNodeId(t);const a=this.getNodeFromId(t);this.module===c&&this.container.querySelector("#node-"+t+" .inputs .input."+l).remove();const s=[];Object.keys(a.inputs[l].connections).map(function(e,u){s.push({id_output:a.inputs[l].connections[u].node,id:t,output_class:a.inputs[l].connections[u].input,input_class:l})}),s.forEach((e,u)=>{this.removeSingleConnection(e.id_output,e.id,e.output_class,e.input_class)}),delete this.drawflow.drawflow[c].data[t].inputs[l];const r=[],m=this.drawflow.drawflow[c].data[t].inputs;Object.keys(m).map(function(e,u){r.push(m[e])}),this.drawflow.drawflow[c].data[t].inputs={};const v=l.slice(6);let d=[];r.forEach((e,u)=>{e.connections.forEach((f,p)=>{d.push(f)}),this.drawflow.drawflow[c].data[t].inputs["input_"+(u+1)]=e}),d=new Set(d.map(e=>JSON.stringify(e))),d=Array.from(d).map(e=>JSON.parse(e)),this.module===c&&this.container.querySelectorAll("#node-"+t+" .inputs .input").forEach((e,u)=>{const f=e.classList[1].slice(6);parseInt(v)<parseInt(f)&&(e.classList.remove("input_"+f),e.classList.add("input_"+(f-1)))}),d.forEach((e,u)=>{this.drawflow.drawflow[c].data[e.node].outputs[e.input].connections.forEach((f,p)=>{if(f.node==t){const w=f.output.slice(6);if(parseInt(v)<parseInt(w)){if(this.module===c){const S=this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+e.node+"."+e.input+".input_"+w);S.classList.remove("input_"+w),S.classList.add("input_"+(w-1))}this.drawflow.drawflow[c].data[e.node].outputs[e.input].connections[p]=f.points?{node:f.node,output:"input_"+(w-1),points:f.points}:{node:f.node,output:"input_"+(w-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeOutput(t,l){var c=this.getModuleFromNodeId(t);const a=this.getNodeFromId(t);this.module===c&&this.container.querySelector("#node-"+t+" .outputs .output."+l).remove();const s=[];Object.keys(a.outputs[l].connections).map(function(e,u){s.push({id:t,id_input:a.outputs[l].connections[u].node,output_class:l,input_class:a.outputs[l].connections[u].output})}),s.forEach((e,u)=>{this.removeSingleConnection(e.id,e.id_input,e.output_class,e.input_class)}),delete this.drawflow.drawflow[c].data[t].outputs[l];const r=[],m=this.drawflow.drawflow[c].data[t].outputs;Object.keys(m).map(function(e,u){r.push(m[e])}),this.drawflow.drawflow[c].data[t].outputs={};const v=l.slice(7);let d=[];r.forEach((e,u)=>{e.connections.forEach((f,p)=>{d.push({node:f.node,output:f.output})}),this.drawflow.drawflow[c].data[t].outputs["output_"+(u+1)]=e}),d=new Set(d.map(e=>JSON.stringify(e))),d=Array.from(d).map(e=>JSON.parse(e)),this.module===c&&this.container.querySelectorAll("#node-"+t+" .outputs .output").forEach((e,u)=>{const f=e.classList[1].slice(7);parseInt(v)<parseInt(f)&&(e.classList.remove("output_"+f),e.classList.add("output_"+(f-1)))}),d.forEach((e,u)=>{this.drawflow.drawflow[c].data[e.node].inputs[e.output].connections.forEach((f,p)=>{if(f.node==t){const w=f.input.slice(7);if(parseInt(v)<parseInt(w)){if(this.module===c){const S=this.container.querySelector(".connection.node_in_node-"+e.node+".node_out_node-"+t+".output_"+w+"."+e.output);S.classList.remove("output_"+w),S.classList.remove(e.output),S.classList.add("output_"+(w-1)),S.classList.add(e.output)}this.drawflow.drawflow[c].data[e.node].inputs[e.output].connections[p]=f.points?{node:f.node,input:"output_"+(w-1),points:f.points}:{node:f.node,input:"output_"+(w-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeId(t){this.removeConnectionNodeId(t);var l=this.getModuleFromNodeId(t.slice(5));this.module===l&&this.container.querySelector("#"+t).remove(),delete this.drawflow.drawflow[l].data[t.slice(5)],this.dispatch("nodeRemoved",t.slice(5))}removeConnection(){if(null!=this.connection_selected){var t=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var l=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex(function(a,s){return a.node===t[1].slice(13)&&a.output===t[4]});this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(l,1);var c=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex(function(a,s){return a.node===t[2].slice(14)&&a.input===t[3]});this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(c,1),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.connection_selected=null}}removeSingleConnection(t,l,c,a){var s=this.getModuleFromNodeId(t);if(s===this.getModuleFromNodeId(l)){if(this.drawflow.drawflow[s].data[t].outputs[c].connections.findIndex(function(v,d){return v.node==l&&v.output===a})>-1){this.module===s&&this.container.querySelector(".connection.node_in_node-"+l+".node_out_node-"+t+"."+c+"."+a).remove();var r=this.drawflow.drawflow[s].data[t].outputs[c].connections.findIndex(function(v,d){return v.node==l&&v.output===a});this.drawflow.drawflow[s].data[t].outputs[c].connections.splice(r,1);var m=this.drawflow.drawflow[s].data[l].inputs[a].connections.findIndex(function(v,d){return v.node==t&&v.input===c});return this.drawflow.drawflow[s].data[l].inputs[a].connections.splice(m,1),this.dispatch("connectionRemoved",{output_id:t,input_id:l,output_class:c,input_class:a}),!0}return!1}return!1}removeConnectionNodeId(t){const l="node_in_"+t,a=this.container.querySelectorAll(".node_out_"+t);for(var s=a.length-1;s>=0;s--){var r=a[s].classList,m=this.drawflow.drawflow[this.module].data[r[1].slice(13)].inputs[r[4]].connections.findIndex(function(e,u){return e.node===r[2].slice(14)&&e.input===r[3]});this.drawflow.drawflow[this.module].data[r[1].slice(13)].inputs[r[4]].connections.splice(m,1);var v=this.drawflow.drawflow[this.module].data[r[2].slice(14)].outputs[r[3]].connections.findIndex(function(e,u){return e.node===r[1].slice(13)&&e.output===r[4]});this.drawflow.drawflow[this.module].data[r[2].slice(14)].outputs[r[3]].connections.splice(v,1),a[s].remove(),this.dispatch("connectionRemoved",{output_id:r[2].slice(14),input_id:r[1].slice(13),output_class:r[3],input_class:r[4]})}const d=this.container.querySelectorAll("."+l);for(s=d.length-1;s>=0;s--)v=this.drawflow.drawflow[this.module].data[(r=d[s].classList)[2].slice(14)].outputs[r[3]].connections.findIndex(function(e,u){return e.node===r[1].slice(13)&&e.output===r[4]}),this.drawflow.drawflow[this.module].data[r[2].slice(14)].outputs[r[3]].connections.splice(v,1),m=this.drawflow.drawflow[this.module].data[r[1].slice(13)].inputs[r[4]].connections.findIndex(function(e,u){return e.node===r[2].slice(14)&&e.input===r[3]}),this.drawflow.drawflow[this.module].data[r[1].slice(13)].inputs[r[4]].connections.splice(m,1),d[s].remove(),this.dispatch("connectionRemoved",{output_id:r[2].slice(14),input_id:r[1].slice(13),output_class:r[3],input_class:r[4]})}getModuleFromNodeId(t){var l;const c=this.drawflow.drawflow;return Object.keys(c).map(function(a,s){Object.keys(c[a].data).map(function(r,m){r==t&&(l=a)})}),l}addModule(t){this.drawflow.drawflow[t]={data:{}},this.dispatch("moduleCreated",t)}changeModule(t){this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)}removeModule(t){this.module===t&&this.changeModule("Home"),delete this.drawflow.drawflow[t],this.dispatch("moduleRemoved",t)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){const t=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",t),t}import(t,l=!0){this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),l&&this.dispatch("import","import")}on(t,l){return"function"!=typeof l?(console.error("The listener callback must be a function, the given type is "+typeof l),!1):"string"!=typeof t?(console.error("The event name must be a string, the given type is "+typeof t),!1):(void 0===this.events[t]&&(this.events[t]={listeners:[]}),void this.events[t].listeners.push(l))}removeListener(t,l){if(!this.events[t])return!1;const c=this.events[t].listeners,a=c.indexOf(l);a>-1&&c.splice(a,1)}dispatch(t,l){if(void 0===this.events[t])return!1;this.events[t].listeners.forEach(c=>{c(l)})}getUuid(){for(var t=[],l=0;l<36;l++)t[l]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}}}]).default}}]);